<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: Selectors and timing
  
    &mdash; Centric Cucumber Framework
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/cucumber.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README_SELECTORS_AND_TIMING";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/cucumber.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: Selectors and timing</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="feature_list_link"
        href="feature_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h2>Accessing elements on the pages</h2>

<p>Many of the elements you&#39;re working with will not have an ID or name associated with them.   While this would normally make like difficult for us, WorkCenter makes use of the Knockout javascript library allowing us to find elements based on their knockout bindings. For example, the declaration below for the save_route button has a knockout binding that calls &quot;saveRoute&quot; on click, allowing us to uniquely identify it.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_button_hooked'>button_hooked</span><span class='lparen'>(</span><span class='symbol'>:save_route</span><span class='comma'>,</span> <span class='label'>data_bind:</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>click: saveRoute</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='label'>hooks:</span> <span class='const'>WFO_HOOKS</span><span class='rparen'>)</span> 
</code></pre>

<p>Note that this is also declared as button_hooked, not button.  It also has a hooks option at the end.  This is a custom extension for PageObject that allows us to perform actions before / after methods are called on the element.</p>

<h2>Managing timing issues</h2>

<h3>Captain Hook</h3>

<p>By using the hooked accessors extension we can make it easier on ourselves to managing timing issues, and repetitive actions.</p>

<p>The file lib/element_hooks.rb contains hook definitions for common actions.  Of particular interest are WFA_HOOKS and WFO_HOOKS.  These hooks ensure that wait_for_ajax or wait_for_overlay get called for actions that would trigger ajax calls.  (Note: WFO, includes WFA so you only need one) By using these hooks we ensure that we can&#39;t ever forget to wait properly, and we save ourselves some typing.</p>

<p>These hooks can help DRY up our code:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>AM_HOOKS</span> <span class='op'>||=</span> <span class='id identifier rubyid_define_hooks'>define_hooks</span> <span class='kw'>do</span> 
  <span class='id identifier rubyid_before'>before</span><span class='lparen'>(</span><span class='symbol'>:click</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='symbol'>:ensure_action_menu_open</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_link_hooked'>link_hooked</span><span class='lparen'>(</span><span class='symbol'>:add_territory</span><span class='comma'>,</span> <span class='label'>data_bind:</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>click: addTerritory</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='label'>hooks:</span> <span class='const'>AM_HOOKS</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='const'>WFA_HOOKS</span><span class='rparen'>)</span><span class='rparen'>)</span> 
</code></pre>

<p>With this we can make sure our action menu is open before attempting to click any of the links contained in it.  We also perform a WFA.</p>

<h3>BasePage</h3>

<p>The BasePage class defines several helper methods for dealing with timing:</p>

<ul>
<li>wait_for_overlay - Will block until any overlays disappear.</li>
<li>dismiss_toasts - Will remove any active toasts.</li>
<li>dismiss_expected_toasts - Will block until toasts appear then dismiss them.</li>
<li>wait_till_loaded - Will block until the page has been fully loaded.  Subclasses must define a &#39;loaded?&#39; function to ensure this works properly.</li>
</ul>

<h3>CSS State</h3>

<p>The CSS state extension  allows us to define states for elements based on their CSS classes.  For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_link'>link</span><span class='lparen'>(</span><span class='symbol'>:show_contacts</span><span class='comma'>,</span> <span class='label'>data_bind:</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>ShowContacts</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_css_state'>css_state</span><span class='lparen'>(</span><span class='symbol'>:show_contacts</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>open:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>k-minus</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>closed:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>k-plus</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>default:</span> <span class='symbol'>:closed</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
</code></pre>

<p>The show_contacts link can either be opened or closed.  Clicking it toggles this state.  With this we can do something like the following:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_show_contacts'>show_contacts</span> <span class='kw'>unless</span> <span class='id identifier rubyid_show_contacts_open?'>show_contacts_open?</span>
</code></pre>

<p>Or:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_wait_until'>wait_until</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Contacts did not open</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_show_contacts_open?'>show_contacts_open?</span> <span class='rbrace'>}</span>
</code></pre>
</div></div>

      <div id="footer">
  Generated on Wed Sep 25 14:11:39 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.20 (ruby-2.4.2).
</div>

    </div>
  </body>
</html>